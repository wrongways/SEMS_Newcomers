<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Jez Wain">
<title>Smart Energy Management System</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Smart Energy Management System</h1>
<div class="details">
<span id="author" class="author">Jez Wain</span><br>
<span id="email" class="email"><a href="mailto:jez.wain@bull.net">jez.wain@bull.net</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_collectively_the_hpc_system_providers_encouraged_by_a">Introduction Collectively the HPC system providers, encouraged by a</a>
<ul class="sectlevel2">
<li><a href="#_smart_energy_management_system_components_the_smart_energy">Smart Energy Management System components The Smart Energy</a></li>
<li><a href="#_energy_optimizer_energy_optimizer_eo_is_something_of_a">Energy Optimizer Energy optimizer (eo) is something of a</a></li>
<li><a href="#_dynamic_power_optimizer_the_dynamic_power_optimizer_dpo_adjusts">Dynamic power optimizer The dynamic power optimizer (dpo) adjusts</a></li>
<li><a href="#_where_sems_fits_in">Where SEMS fits in</a></li>
</ul>
</li>
<li><a href="#_containers">Containers</a>
<ul class="sectlevel2">
<li><a href="#_pods">Pods</a></li>
<li><a href="#_container_engines">Container engines</a></li>
<li><a href="#_container_images">Container images</a></li>
<li><a href="#_podman_vs_docker">Podman vs Docker</a></li>
<li><a href="#_podman">Podman</a></li>
<li><a href="#_images">Images</a></li>
<li><a href="#_podman_images">Podman images</a></li>
<li><a href="#_kubernetes">Kubernetes</a></li>
</ul>
</li>
<li><a href="#_glossary">Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>_Felix qui potuit rerum cognoscere causas._

Lucky is he who has been able to understand the causes of things</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_collectively_the_hpc_system_providers_encouraged_by_a">Introduction Collectively the HPC system providers, encouraged by a</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.energy.gov/sites/prod/files/2013/09/f2/20130913-SEAB-DOE-" class="bare">https://www.energy.gov/sites/prod/files/2013/09/f2/20130913-SEAB-DOE-</a>
Exascale-Initiative.pdf[2008 DARPA paper] have set themselves the
ambition of attaining exascale performance (10<sup>18</sup> FLOPS) with a power
budget of 20&nbsp;MW. At the time of writing (2023) this works out at
around €25k and 40 tonnes of CO<sub>2</sub> per day. Even though 20&nbsp;MW is
sufficient to power a town of 120,000 people<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, to achieve this
goal will require an order-of-magnitude improvement from where we are
today. If we are to meet this ambitious but laudable goal then dramatic
improvements are required across all facets of HPC data centres: power
efficient circuits, energy conservation, peak power management, power
delivery and cooling (server and data centre)<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div class="paragraph">
<p>This paper presents Atos' Smart Energy Management System (SEMS) and how
it fits in with the rest of the HPC cluster administration tools.</p>
</div>
<div class="paragraph">
<p>SEMS provides tools to address peak power management with the goal of
reducing the overall energy (and CO2) footprint and peak power on Atos’
HPC clusters while minimizing service level degradation by adjusting
server performance to the variations in workload demand within a given
power budget.</p>
</div>
<div class="sect2">
<h3 id="_smart_energy_management_system_components_the_smart_energy">Smart Energy Management System components The Smart Energy</h3>
<div class="paragraph">
<p>Management System comprises two distinct components: 1) Energy optimizer
(eo), and 2) dynamic power optimizer (dpo).</p>
</div>
<div class="sect3">
<h4 id="_principles_of_operation_both_of_these_components_act_upon_computing">Principles of operation Both of these components act upon computing</h4>
<div class="paragraph">
<p>power draw, either in the CPU or GPU<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>. As a first-order
approximation the power draw of an integrated circuit is a function of
the cube of the frequency: \$P \approx kf^3\$. Small increases in
frequency (performance) require much larger increases in power.
Conversely, small reductions in performance bring large reductions in
power: A 5% performance drop brings close to 15% reduction in power.
Both energy optimizer and dynamic performance optimizer rely on a
technology known as dynamic voltage and frequency scaling (dvfs)
available on most major CPU/GPU architectures.</p>
</div>
<div class="paragraph">
<p>Of course, the CPU is only one part of a server, power supply, memory,
storage, networking, and cooling all consume non-negligible power.
Nevertheless, under load, the dominant energy/power consumers are the
CPU and GPU.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_energy_optimizer_energy_optimizer_eo_is_something_of_a">Energy Optimizer Energy optimizer (eo) is something of a</h3>
<div class="paragraph">
<p>misnomer<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> as it does absolutely nothing to
optimize energy usage. Instead it provides two functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Historical reporting of energy and temperature of data centre
equipment * Apply upper limits to cap instantaneous power draw of
servers (CPU or GPU)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_power_optimizer_the_dynamic_power_optimizer_dpo_adjusts">Dynamic power optimizer The dynamic power optimizer (dpo) adjusts</h3>
<div class="paragraph">
<p>the performance of CPU cores using voltage/frequency scaling to the near
real-time processing load of a compute node. DPO only operates on CPUs –
it does not affect GPUs. It is installed on each host that is to be
optimized and works fully in-band.</p>
</div>
</div>
<div class="sect2">
<h3 id="_where_sems_fits_in">Where SEMS fits in</h3>
<div class="paragraph">
<p>Before we look at the details of Energy Optimizer and Dynamic Power
Optimizer, we need to understand the overall architecture of an HPC
system and where and how SEMS fits in to this organization. In the
process we&#8217;ll take a detour down the rabbit hole of containers.
include::02_hpc_architecture.adoc
:icons: font</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_containers">Containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Atos' offers two solutions for cluster management, SMC and SMC&nbsp;xScale. Both
use container technology. SMC uses podman, SMC&nbsp;xScale uses kubernetes. It
turns out that the distinction between the two has an unreasonably
large<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> repercussion
on all sorts of things from the structure of the git repository and
ansible playbooks, to the documentation. It is therefore necessary to introduce
this material before looking in detail at the SEMS constituent parts. This
chapter introduces containers before looking at the specifics of podman and kubernetes.</p>
</div>
<div class="paragraph">
<p>Containers are a light-weight virtualization technology providing an isolated execution
environment for applications that run on Linux. They are an evolution of BSD&nbsp;Jails,
and <strong>chroot</strong> before that<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.
A container has it&#8217;s own namespace and applications
running inside a container have no visibility of other containers or the host OS.
The most common container environment is Docker, but there are others such as Podman (OCI-R),
Linux containers, Rocket, and Cloud Foundry.</p>
</div>
<div class="paragraph">
<p>Compared to virtual machines, containers are much smaller and faster to deploy and tear down.
The key advantage of containers is that they give precise control over the environment
in which an application executes – which versions of tools, languages, libraries, and
packages. The isolation between containers allows for one application to be running
Python&nbsp;v3.9 and another using Python&nbsp;v3.10 on the same server<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>A second benefit of containers is that their contents and construction are described
in code, as a configuration file. This allows easy integration into a CI/CD workflow
for build, test and deployment.</p>
</div>
<div class="paragraph">
<p>Containers are frequently used for applications deployed on a cloud infrastructure. They
map particularly well with the notion of <em>micro-services</em> where each specific function
runs in its own container – for example in a typical three-tier application, the web-server,
application server (middleware), and database will each have their own container. This
allows for independent scaling of each of the components, for example, it is possible to
have two instances of the front-end web server if needed, without changing the anything
in the back-end.</p>
</div>
<div class="paragraph">
<p>Using Linux&#8217;s resource constraints (<code>cgroups</code>), containers can be limited in the amount
of memory, CPU, network that they
consume, limiting the noisy neighbour effect to a degree. Containers can also help with
security, file systems can be mounted
as read-only and the kernel filesystem is always read-only. Podman (see below)
allows for non-root users to create and control their own containers.
This means that should a bad actor manage to break out of a container, the damage she/he
may inflict is considerably more limited that it would be were the container running with
root privileges<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup> and
unfettered write access to the file-system.</p>
</div>
<div class="paragraph">
<p>It&#8217;s not all a bed of roses though, despite what you might hear the evangelists telling you.
Containers multiply the number of things that can go wrong and diagnosing the causes
is intrinsically more complicated with so many more moving pieces.
Network interfaces and storage devices breed like rabbits and they all have to be
managed. Also, because we never
occupy resources at 100%, we always leave some margin, the amount of unused and unusable
disk space tends to be greater when using containers and micro-services than when the same
application runs in a single OS instance. Each container has to be managed with updates,
backups and the usual lifecycle stuff.</p>
</div>
<div class="sect2">
<h3 id="_pods">Pods</h3>
<div class="paragraph">
<p>Frequently any given service is made up of two or more closely related functions for which
it makes sense to deploy as as single unit. For this podman and kubernetes (see below)
introduce the notion of <em>pods</em>, a (small) number of containers treated as a single entity
(for deploy, start, stop, &#8230;&#8203;).</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_engines">Container engines</h3>
<div class="paragraph">
<p>The executable that runs in a container is known as an image. A container is a running
image<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>. Images are stored locally or
in an image repository which may be public or private. The most well-known public image
repository is <a href="https://hub.docker.com">Docker hub</a>.</p>
</div>
<div class="paragraph">
<p>A container engines perform three key roles:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Image construction
</td>
<td class="hdlist2">
<p>Define the contents of an image and the steps required to build it.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Container and pod construction
</td>
<td class="hdlist2">
<p>Configure containers and pods to run on a given system.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Runtime
</td>
<td class="hdlist2">
<p>Services to control the container/pod lifecycle (start, stop, &#8230;&#8203;). The two
most common runtimes are <code>runc</code> and <code>crun</code>. <code>crun</code> is the more modern and faster of the two.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_container_images">Container images</h3>
<div class="paragraph">
<p>A container image comprises three elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A directory tree containing all the software and libraries that make up your application.
The root of this tree becomes the root filesystem, <em>rootfs</em>, (under <code>/</code>) of the container.</p>
</li>
<li>
<p>A JSON file describing the contents of the <em>rootfs</em>.</p>
</li>
<li>
<p>A manifest, also in JSON format, that ties the image to one or more specific processor
architectures – you cannot deploy an image built for IBM PowerPC on an ARM-based server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These three elements are bundled into a standard UNIX tar file. This tar file is then generally
pushed to an image repository. Container systems such as podman or docker, then download and
unpack the image onto a host. Then, the container system can launch the container runtime
(<code>runc</code> or <code>crun</code> typically) which uses the JSON file to configure the host container and
launch in turn the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_podman_vs_docker">Podman vs Docker</h3>
<div class="paragraph">
<p>The two most common container engines are podman and docker<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup>.
Podman is a modern drop-in replacement for Docker. Arriving after docker it has benefitted
from all the lessons learnt and offers, in my view, several improvements over its
predecessor, these include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Podman supports pods</dt>
<dd>
<p>It&#8217;s in the name, podman allows grouping of tightly coupled
containers into a single pod which is then managed as a unit.</p>
</dd>
<dt class="hdlist1">Podman is a command, not a daemon</dt>
<dd>
<p>This detail brings considerable benefits, especially
when upgrading the container runtime. Docker runs as a daemon and shutting docker down
requires that all the containers are shut down too. Podman, run on-demand as command, exits
once its operation is complete and the containers remain operational. Therefore updating
podman can take place without any interruption of service.</p>
<div class="paragraph">
<p>Podman follows the UNIX <em>fork/exec</em> paradigm and as such a container is a child process of
podman belonging to the UID of the user that executed the command. Under docker, the
container is a child of the docker daemon (<code>containerd</code>) rather than the docker client.</p>
</div>
</dd>
<dt class="hdlist1">Non-root user containers</dt>
<dd>
<p>Ordinary, unprivileged users can create images and podman
containers. An ever-increasing number of companies are outlawing root access – I don&#8217;t
even have root access on my company laptop<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup>
Docker&#8217;s approach of putting users in the <code>docker</code> group is fraught with danger
as it allows for a simple escape out of a container into the host OS.</p>
</dd>
<dt class="hdlist1">Podman plays nicely with <em>systemd</em></dt>
<dd>
<p>Much to the chagrin of many, <em>systemd</em> has become
the standard Linux intialization mechanism.
Docker has traditionally resisted all attempts to integrate
with systemd, maintaining that only docker should control the container lifecycle.
Podman allows</p>
<div class="ulist">
<ul>
<li>
<p>systemd to manage the lifecyle of containers</p>
</li>
<li>
<p>containers to have their own systemd</p>
</li>
<li>
<p>send systemd notifications</p>
</li>
<li>
<p>socket activation in a container</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Podman is compatible with kubernetes</dt>
<dd>
<p>Podman can produce and read configuration files in
the format used by kubernetes which greatly simplifies migrating between the two and can
help when debugging kubernetes deployment problems.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The podman command line is a superset of that of docker – if you set <code>alias docker=podman</code> in
your <code>.zsh</code> or <code>.bashrc</code> file, then everything should continue to work as expected, otherwise it&#8217;s
considered a bug by the podman team<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>The only way to come to grips with the technology is to install it on a machine and to kick the tyres.
The next section gives a quick run-down of podman operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_podman">Podman</h3>
<div class="sect3">
<h4 id="_installation">Installation</h4>
<div class="paragraph">
<p>The https:://podman.io[podman website] has all the details with <a href="https://podman.io/getting-started/installation">instructions on how to install
on MacOS and Linux</a> (or Windows if you don&#8217;t know any better)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_images">Images</h3>
<div class="paragraph">
<p><a href="https://hub.docker.com/search">Docker hub</a> and <a href="https://gallery.ecr.aws">Amazon</a> host a
multitude of container images. Some are
officially sanctioned, others are made available by developers of varying abilities, some
good, some less so. You can download any of these images and use it as-is or use as a base
for customization. Without creating an account at <a href="https://docker.com">Docker (the company)</a>
you are quickly rate limited. I tend to opt for Amazon.</p>
</div>
<div class="paragraph">
<p>For the the following discussion will use the official nginx image.</p>
</div>
<div class="paragraph">
<p>To run and connect to this image&#8217;s shell, you can use the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% podman run -it --rm public.ecr.aws/nginx/nginx:1-alpine-perl sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command line options are the following:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
-i
</td>
<td class="hdlist2">
<p>Interactive, keep <em>stdin</em> open.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-t
</td>
<td class="hdlist2">
<p>Attach a pseudo terminal. This option is generally used for
a throw-away shell as in our example.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
--rm
</td>
<td class="hdlist2">
<p>Remove the container when it exits.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
public.ecr.aws/nginx/nginx:1-alpine-perl
</td>
<td class="hdlist2">
<p>The fully qualified name of the image to load.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
sh
</td>
<td class="hdlist2">
<p>The command to run. This is frequently optional as many containers have a default
executable. For nginx, without surprise, the default command is to run the http server.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Podman downloads the <strong>nginx</strong> image from docker hub (other imagage repositories can be configured)
in chunks (<em>blobs</em>) and saves it to a local cache. If you create a second container based on
the same image, the download step will be elided.</p>
</div>
<div class="sect3">
<h4 id="_running_the_containerized_application">Running the containerized application</h4>
<div class="paragraph">
<p>In our first contact with podman containers you ran the zsh/bash shell. This is not the
application that the image builder had in mind. Here&#8217;s how to run the nginx http server
as intended.</p>
</div>
<div class="paragraph">
<p>First create a directory to hold a html files and add a home page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% mkdir html
% cat &lt;&lt;EOF &gt; html/index.html
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;title&gt;My first containerized web server&lt;/title&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;meta name="author" content="Wrongways Skidmark"&gt;
  &lt;sytle&gt;
      :root {
          font-family: system-ui, ui-sans-serif, helvetica;
      }

      h1 {
          color: red;
          font-weight: 200;
      }
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;This is my first containerized web page 🏆&lt;/h1&gt;
  &lt;p&gt;It'll be amazing 🧨 if it works first time&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you have a web page, you can add it to your containerized nginx application when
you launch it. Here&#8217;s the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% podman run -d \ # <b class="conum">(1)</b>
    --name  web_server \ # <b class="conum">(2)</b>
    -v "${PWD}/html":/usr/share/nginx/html:ro \ # <b class="conum">(3)</b>
    -p 8080:80 \ # <b class="conum">(4)</b>
    nginx # <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>We no loner require an interactive session nor a terminal, so these option have been removed.
The container will not be automatically deleted when it exits either. The new options are:</p>
</div>
<div class="colist arabic">
<ol>
<li>
<p>-d or <code>--detatch</code>, instructs podman to run the container in the background. The podman command
will exit, leaving the container running.</p>
</li>
<li>
<p>--name – give the container a custom name</p>
</li>
<li>
<p>-v or --volume. Binds a directory on the host to a directory in the container. In this case
maps the directory <strong>html</strong> you just created on the host to the directory that nginx uses to
serve web pages. The <strong>:ro</strong> tag mounts the volume as read-only, so the container cannot modify
the files on the host.</p>
</li>
<li>
<p>-p or <code>--publish</code>. Podman binds the container port (the second <code>8080</code>) to a host port (the first <code>8080</code>)
providing a bridge from the host to the container. It is custom to use the same port on the host and the
container where possible. Of course if you run a second instance of nginx, then the host&#8217;s 8080 port
is already take so you have to specify a different one. i.e. -p 8081:8080.</p>
</li>
<li>
<p>nginx – the image to launch.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now you can launch a browser on the host and connect to <strong><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></strong> and, if all goes to
plan, you should see the spectacular page we wrote earlier.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stopping_containers">Stopping containers</h4>
<div class="paragraph">
<p>Now you have a running container - how do you kill it? Without much surprise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% podman stop web_server</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the first part of the container ID instead of the name - it has to be sufficiently long
to uniquely identify the container. By default podman will wait ten seconds for the container to
gracefully exit before using the nuclear option with <code>SIGKILL</code>. You can control the grace time with the
<code>-t</code> switch of the stop command.</p>
</div>
</div>
<div class="sect3">
<h4 id="_restarting_containers">Restarting containers</h4>
<div class="paragraph">
<p>If you run <code>podman ps --all</code> (see below), you will see the <strong>my_web_server</strong> container, even though it is not running.
You can re-run the container with the same options as when you first launched it by simply typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% podman start web_server</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now reconnect your web browser with the web server.</p>
</div>
<div class="paragraph">
<p>The podman start command launches one or more containers, printing the container IDs. If you add the <code>-all</code>
switch, all stopped containers will be relaunched.</p>
</div>
</div>
<div class="sect3">
<h4 id="_listing_containers">Listing containers</h4>
<div class="paragraph">
<p>As hinted at above, you can list containers using the <code>podman ps</code></p>
</div>
<div class="paragraph">
<p>Without any options this command lists only running containers. the <code>--all</code> switch adds halted ones too.</p>
</div>
</div>
<div class="sect3">
<h4 id="_container_and_image_details">Container and image details</h4>
<div class="paragraph">
<p>Podman has an inspect command to examine the details of containers and images.
The output is in JSON format, so it&#8217;s handy to have the <a href="https://stedolan.github.io/jq/"><strong><code>jq</code></strong></a> command installed -
<strong>jq</strong> is available as an installable package on most Linux distributions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman inspect web_server | jq -C | less -R</code></pre>
</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
-C
</td>
<td class="hdlist2">
<p>tells jq to use colour</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-R
</td>
<td class="hdlist2">
<p>tells less to pass-through raw colour characters</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The top level structure is an array, with one element (index=0) containing a dictionary.
jq can select specific elements in the JSON. For example to get the command, which is in
the <strong>Config</strong> section with the key <strong>Cmd</strong> use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman inspect web_server | jq '[0].Config.Cmd'</code></pre>
</div>
</div>
<div class="paragraph">
<p>When printing to the terminal, jq uses colour by default, so we don&#8217;t need the <code>-C</code> switch.</p>
</div>
<div class="paragraph">
<p>Alternatively, if you don&#8217;t have <strong>jq</strong> installed you can use the clunky <code>--format</code> switch of the
podman inspect command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman inspect web_server --format "Run command: {{.Config.Cmd}}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t get any colour and you have to add your own text to identify each field. If you
ask for the whole <strong>Config</strong> entry you get a bunch of untagged fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman inspect web_server --format "Run command: {{.Config}}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compare this to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman inspect web_server | jq '[0].Config'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a similar way you can inspect images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman image inspect image_id | image_name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again, <strong>jq</strong> is your friend to extract the stanzas you&#8217;re interested in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman image inspect 3374720 | jq '.[0].Size'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_images">Deleting images</h4>
<div class="paragraph">
<p>To remove an image you no longer require, freeing up disk space</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman rmi &lt;image-id | image-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively, use prune which removes images that aren&#8217;t currently used by a container</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">podman image prune [-a]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TODO: Output of <code>podman rmi &lt;image-id | image-name&gt;</code> and <code>podman image prune</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_podman_commands">Podman commands</h4>
<div class="paragraph">
<p>There is a plethora of additional podman commands. These are summarized in the table below. See
<a href="https://docs.podman.io/en/latest/Commands.html">the podman site</a> for details.</p>
</div>
<details>
<summary class="title">Click here to see the full list of podman commands</summary>
<div class="content">
<table class="tableblock frame-ends grid-all stripes-hover" style="width: 80%;">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 81.8182%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman.1.html">podman</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Pod Manager) Global Options, Environment Variables, Exit Codes, Configuration Files, and more</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-attach.1.html">attach</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attach to a running container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-auto-update.1.html">auto-update</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto update containers according to their auto-update policy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-build.1.html">build</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build an image using instructions from Containerfiles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-commit.1.html">commit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create new image based on the changed container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-container.1.html">container</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage Containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-cp.1.html">cp</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy files/folders between a container and the local filesystem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-create.1.html">create</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create but do not start a container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-diff.1.html">diff</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inspect changes on container’s file systems</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-events.1.html">events</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show podman events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-exec.1.html">exec</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a process in a running container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-export.1.html">export</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Export container’s filesystem contents as a tar archive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-generate.1.html">generate</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generated structured data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-healthcheck.1.html">healthcheck</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage Healthcheck</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-history.1.html">history</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show history of a specified image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-image.1.html">image</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-images.1.html">images</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List images in local storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-import.1.html">import</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import a tarball to create a filesystem image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-info.1.html">info</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display podman system information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-init.1.html">init</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initialize one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-inspect.1.html">inspect</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the configuration of a container or image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-kill.1.html">kill</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kill one or more running containers with a specific signal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-kube.1.html">kube</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Play a pod</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-load.1.html">load</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load an image from container archive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-login.1.html">login</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login to a container registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-logout.1.html">logout</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout of a container registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-logs.1.html">logs</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fetch the logs of a container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-machine.1.html">machine</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage podman’s virtual machine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-manifest.1.html">manifest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and manipulate manifest lists and image indexes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-mount.1.html">mount</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mount a working container’s root filesystem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-network.1.html">network</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage Networks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-pause.1.html">pause</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pause all the processes in one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-pod.1.html">pod</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-port.1.html">port</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List port mappings or a specific mapping for the container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-ps.1.html">ps</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-pull.1.html">pull</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pull an image from a registry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-push.1.html">push</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Push an image to a specified destination</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-rename.1.html">rename</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename an existing container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-restart.1.html">restart</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restart one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-rm.1.html">rm</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-rmi.1.html">rmi</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes one or more images from local storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-run.1.html">run</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a command in a new container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-save.1.html">save</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save image to an archive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-search.1.html">search</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search registry for image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-secret.1.html">secret</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage podman secrets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-start.1.html">start</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-stats.1.html">stats</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display a live stream of container resource usage statistics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-stop.1.html">stop</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-system.1.html">system</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage podman</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-tag.1.html">tag</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add an additional name to a local image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-top.1.html">top</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the running processes of a container</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-unmount.1.html">unmount</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unmounts working container’s root filesystem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-unpause.1.html">unpause</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unpause the processes in one or more containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-unshare.1.html">unshare</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a command in a modified user namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-untag.1.html">untag</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes one or more names from a locally-stored image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-version.1.html">version</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the Podman Version Information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-volume.1.html">volume</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage volumes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.podman.io/en/latest/markdown/podman-wait.1.html">wait</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block on one or more containers</p></td>
</tr>
</tbody>
</table>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_podman_images">Podman images</h3>
<div class="paragraph">
<p>So far the images we&#8217;ve seen have been provided by a registry. But SEMS is an application with a custom
application. In this section we look at how you can build your own images.</p>
</div>
<div class="paragraph">
<p>We (almost) always start from a base image from a repository and customize its content and behaviour.
The base image might be just the base Linux operating system or it may include additional components
such as Node.js, a database, or programming languages (python, rust, ruby, clang, gcc).</p>
</div>
<div class="paragraph">
<p>Podman has a <code>build</code> command which invokes a tool called <code>buildah</code></p>
</div>
<div class="paragraph">
<p>Images are built incrementally</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Need diagram with layered images: Linux &#8594; + nginx &#8594; my-app
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To see the components of your image use the <code>podman image tree &lt;image-name&gt;</code> command and to see the differences
between two images use `podman image diff &lt;img1&gt; &lt;img2&gt; which lists files that have been added (A),
removed (D), and changed (C).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TODO Output of <code>podman image tree &lt;image-name&gt;</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TODO Output of <code>podman image diff &lt;img1&gt; &lt;img2&gt;</code>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_building_images">Building images</h4>
<div class="paragraph">
<p>To construct the simplest way is to populate a file called either <strong>Containerfile</strong> or <strong>Dockerfile</strong>, the
latter to be able to compatible with docker. This file describes all the steps required to create
your image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the base image</p>
</li>
<li>
<p>Set environment variables</p>
</li>
<li>
<p>Install modules and packages</p>
</li>
<li>
<p>Run arbitrary commands</p>
</li>
<li>
<p>Copy files from the host or the internet to the image</p>
</li>
<li>
<p>Establish the working directory</p>
</li>
<li>
<p>Stipulate the command to be run when the image is launched</p>
</li>
<li>
<p>Specify the username that will own the executable</p>
</li>
<li>
<p>Set tags and labels</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This file is usually in the root directory of your application. Here&#8217;s a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% cat myapp/Containerfile
FROM
COPY index.html /usr/share/nginx/html/</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these files&#8201;&#8212;&#8201;Containerfile and index.html&#8201;&#8212;&#8201;in place you can build your image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% podman build ./myapp</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kubernetes">Kubernetes</h3>
<div class="paragraph">
<p>k8s for the hip.
:leveloffset: -1</p>
</div>
<div class="sect3">
<h4 id="_levers_for_controlling_frequency_and_power">Levers for controlling frequency and power</h4>
<div class="sect4">
<h5 id="_in_band_and_out_of_band">In-band and out-of-band</h5>
<div class="paragraph">
<p>Today&#8217;s servers come with their own management system, known as the baseboard management controller
or more colloquially the <strong>bmc</strong>. Operations that are applied to a server, boot, shutdown etc that take
place via the bmc are said to be <strong>out-of-band</strong>. The same operations performed from the operating system
are said to be <strong>in-band</strong>.</p>
</div>
<div class="paragraph">
<p>Of the different interfaces that Smart Energy Management System uses the Intel runtime average power
limit (rapl) interface — see <a href="#_intel_rapl">rapl</a> below is in-band<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup>. The other interfaces
described below are out-of-band, relying on the bmc. The current trend is to move away from in-band
monitoring and control towards more frequent use of out-of-band.</p>
</div>
</div>
<div class="sect4">
<h5 id="_intel_rapl">Intel rapl</h5>
<div class="paragraph">
<p>The running average power limit (rapl) monitors and controls power for a CPU socket (package),
the cores, the uncores (processor components other than the cores), and main memory (DRAM).
Power consumption is sampled and averaged over a time window. The average is compared against
the user-defined thresholds. If any of the limits are exceeded the on-board power management
algorithm throttles the maximum CPU frequency accordingly. Power measurement is indirect through
a set of hardware counters.</p>
</div>
<div class="paragraph">
<p>Once limits have been set power consumption is managed by RAPL without intervention from an
external management system.</p>
</div>
<div class="paragraph">
<p>Capping and monitoring using rapl is in-band (from the operating system).</p>
</div>
</div>
<div class="sect4">
<h5 id="_data_centre_manageability_interface_dcmi">Data centre manageability interface (DCMI)</h5>
<div class="paragraph">
<p>DCMI is an Intel standard for managing servers, including power through the baseboard management
controller (BMC). Compliant platforms allow external management tools to monitor and control server
power usage. The interface is coarse-grained compared to the running average power limit in that it
provides controls and monitors for the overall system power.</p>
</div>
</div>
<div class="sect4">
<h5 id="_intel_node_manager">Intel Node Manager</h5>
<div class="paragraph">
<p>Intel Node Manager is a replacement for DCMI. It also uses the BMC to send commands to the
on-chip management engine, with a subset of commands addressing power usage. It monitors
power usage from the server, provides controls for maximum server power and can automatically
reduce power consumption via CPU frequency.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dmtf_redfish">DMTF Redfish</h5>
<div class="paragraph">
<p>The distributed management task-force (DMTF) Redfish specification is an open standard that
can be considered a competitor to the Intel DCMI. The Redfish specification covers a wide
range of data centre management domains including server power and data centre power distribution.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="_glossary" class="sect0">Glossary</h1>
<div class="openblock partintro">
<div class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
bmc
</td>
<td class="hdlist2">
<p>Baseboard management controller</p>
</td>
</tr>
<tr>
<td class="hdlist1">
in-band
</td>
<td class="hdlist2">
<p>Said of operations that take place from the operating system</p>
</td>
</tr>
<tr>
<td class="hdlist1">
out-of-band
</td>
<td class="hdlist2">
<p>Said of operations that are driven through the BMC</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. From <a href="https://www.destatis.de/EN/Themes/Society-Environment/Environment/" class="bare">https://www.destatis.de/EN/Themes/Society-Environment/Environment/</a> Material-Energy-Flows/Tables/electricity-consumption-households.html a two-person household consumes roughly 3,200 kWh per year: 20,000 kW * 365 days * 24 hours / 3,200kWh * 2 people =~ 117,000 people. Towns of this size include Round Rock and Abilene in Texas, Metz and Rouen in France or Burton-upon-Trent and Eastbourne in the UK
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. If you&#8217;re serious about conserving energy, I&#8217;d argue that you should not be on systems that use the x86 architecture
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. In theory this could include other equipment such as network switches, power distribution units, uninterruptible power supplies, pumps, etc., but as is often the case, there&#8217;s a big gap between theory and practice
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Deceptive marketing?
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. In my opinion
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. IBM had workload partitions as a knee-jerk reaction to Solaris' containers years before Linux containers and Docker became a thing, but IBM never realized what a great feature they were and as a result they were never fully developed – a major missed opportunity
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Of course this is also possible using python virtual environments
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. Docker allows this too, but it is rarely used in practice
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. or an image that has run in the past - the command <code>podman ps --all</code> shows both running and non-running containers
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. Don&#8217;t confuse docker the tool with <strong>D</strong>ocker the company.
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. Which turns out to be a right royal pain in the proverbial and a self-inflicted denial of service as it slows my productivity by a significant factor.
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. Of course <code>docker --help</code> will now produce podman help which may or may not come as a surprise
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. The Nvidia system management interface (smi) for GPUs is also in-band, but this is not currently used by SEMS
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-05-03 12:45:37 +0200
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>